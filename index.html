<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>cafecitoDNA by Lento</title>
  <meta name="description" content="Discover your cafecitoDNA. Tell us in your own words. Created by Lento." />
  <meta property="og:title" content="What's your cafecitoDNA?" />
  <meta property="og:description" content="Tell us what you like in coffee. AI turns it into a profile you can show any barista." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'DM Sans', sans-serif; -webkit-font-smoothing: antialiased; }
    @keyframes fadeIn { from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:translateY(0)} }
    @keyframes fadeUp { from{opacity:0;transform:translateY(14px)} to{opacity:1;transform:translateY(0)} }
  </style>
</head>
<body>
  <div id="root"></div>

  <script>
    window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
  </script>
  <script defer src="/_vercel/insights/script.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const L = {
      orange: "#FF914C", orangeDeep: "#CF7040", orangeDark: "#B85E30",
      green: "#2F5F3A", teal: "#017680", coral: "#C76356",
      ember: "#C48B6A", cream: "#FFFAF5", warmBg: "#FFF5ED",
      dark: "#2A1A0E", darkWarm: "#42291A",
      muted: "#9A7E6C", mutedLight: "#C4A893",
      white90: "rgba(255,255,255,0.92)",
    };

    const WHATSAPP_LINK = "https://chat.whatsapp.com/CCoLMCoPE8h2GFpT5x0qC5";
    const INSTAGRAM_LINK = "https://instagram.com/justlento";

    const bg = `
      radial-gradient(ellipse at 0% 0%, ${L.orange}12 0%, transparent 50%),
      radial-gradient(ellipse at 100% 100%, ${L.teal}08 0%, transparent 45%),
      linear-gradient(170deg, ${L.cream} 0%, ${L.warmBg} 60%, #FEF0E4 100%)
    `;

    // ‚îÄ‚îÄ‚îÄ Logo ‚îÄ‚îÄ‚îÄ
    const Logo = ({ size = "large" }) => {
      const s = size === "large" ? { w: 80, r: 24, f: 28 } : { w: 60, r: 18, f: 20 };
      return (
        <div style={{
          width: s.w, height: s.w, borderRadius: s.r,
          background: L.orange, boxShadow: `0 10px 32px ${L.orange}40`,
          display: "flex", alignItems: "center", justifyContent: "center",
          position: "relative", overflow: "hidden",
        }}>
          <div style={{
            position: "absolute", inset: 0,
            background: "radial-gradient(circle at 30% 30%, rgba(255,255,255,0.18) 0%, transparent 55%)",
          }} />
          <span style={{
            fontFamily: "'Pacifico', cursive", fontSize: s.f,
            color: L.orangeDeep, position: "relative", marginTop: 2,
          }}>lento</span>
        </div>
      );
    };

    // ‚îÄ‚îÄ‚îÄ Tag ‚îÄ‚îÄ‚îÄ
    const Tag = ({ children, variant = "orange", onRemove, editable }) => {
      const t = {
        orange: { bg: "#FF914C18", c: "#CF7040", bc: "#FF914C28" },
        teal: { bg: "#01768012", c: "#017680", bc: "#01768022" },
        coral: { bg: "#C7635615", c: "#A04438", bc: "#C7635625" },
        green: { bg: "#2F5F3A12", c: "#2F5F3A", bc: "#2F5F3A22" },
      }[variant] || { bg: "#FF914C18", c: "#CF7040", bc: "#FF914C28" };
      return (
        <span style={{
          display: "inline-flex", alignItems: "center", gap: 4,
          padding: "5px 13px", borderRadius: 999, fontSize: 13, fontWeight: 500,
          fontFamily: "'DM Sans',sans-serif", background: t.bg, color: t.c, border: `1px solid ${t.bc}`,
        }}>
          {children}
          {editable && onRemove && <button onClick={onRemove} style={{
            background: "none", border: "none", cursor: "pointer", fontSize: 14, color: "inherit", padding: 0, marginLeft: 2, opacity: 0.5,
          }}>√ó</button>}
        </span>
      );
    };

    // ‚îÄ‚îÄ‚îÄ Editable ‚îÄ‚îÄ‚îÄ
    const Editable = ({ value, onChange, editable }) => {
      const [on, setOn] = useState(false);
      const [tmp, setTmp] = useState(value);
      if (!editable) return <span>{value}</span>;
      if (on) return <input autoFocus value={tmp}
        onChange={e => setTmp(e.target.value)}
        onBlur={() => { onChange(tmp); setOn(false); }}
        onKeyDown={e => e.key === "Enter" && (onChange(tmp), setOn(false))}
        style={{
          background: "transparent", border: "none", outline: "none",
          borderBottom: `2px solid ${L.orange}`, fontSize: "inherit",
          fontFamily: "inherit", color: "inherit", padding: 0, width: `${Math.max(tmp.length + 1, 5)}ch`,
        }} />;
      return <span onClick={() => { setTmp(value); setOn(true); }} style={{
        cursor: "pointer", borderBottom: `1.5px dashed ${L.orange}55`,
      }}>{value}</span>;
    };

    // ‚îÄ‚îÄ‚îÄ Label ‚îÄ‚îÄ‚îÄ
    const Label = ({ es, en }) => (
      <div style={{
        fontSize: 10, textTransform: "uppercase", letterSpacing: 1.8,
        color: L.muted, marginBottom: 8, fontFamily: "'DM Sans',sans-serif", fontWeight: 700,
      }}>
        {es}{en && <span style={{ opacity: 0.4, fontWeight: 500 }}> ¬∑ {en}</span>}
      </div>
    );

    // ‚îÄ‚îÄ‚îÄ Landing ‚îÄ‚îÄ‚îÄ
    const Landing = ({ onGenerate, loading, error }) => {
      const [text, setText] = useState("");
      const ok = text.trim().length > 10 && !loading;

      return (
        <div style={{ minHeight: "100vh", display: "flex", alignItems: "center", justifyContent: "center", padding: 20, background: bg }}>
          <div style={{ width: "100%", maxWidth: 420, animation: "fadeIn 0.5s ease-out" }}>
            <div style={{ textAlign: "center", marginBottom: 32 }}>
              <div style={{ display: "inline-block", marginBottom: 20 }}><Logo size="large" /></div>
              <h1 style={{
                fontFamily: "'Playfair Display',serif", fontSize: 32, fontWeight: 700,
                color: L.dark, margin: "0 0 6px", lineHeight: 1.2,
              }}>Descubre tu cafecitoDNA</h1>
              <p style={{
                fontFamily: "'DM Sans',sans-serif", fontSize: 14, color: L.muted, margin: 0, lineHeight: 1.5,
              }}>What's your cafecitoDNA? Tell us in your own words.</p>
            </div>

            <div style={{
              background: L.white90, backdropFilter: "blur(20px)",
              borderRadius: 24, padding: 24, border: `1px solid ${L.orange}12`,
              boxShadow: `0 4px 24px ${L.orange}08`,
            }}>
              <textarea value={text} onChange={e => setText(e.target.value)}
                placeholder="I like strong coffee with oat milk, half sweet. Sometimes a mocha or chai. I hate anything that tastes burnt or too syrupy..."
                rows={4}
                style={{
                  width: "100%", boxSizing: "border-box", border: `2px solid ${L.orange}15`,
                  borderRadius: 16, padding: 16, fontSize: 15, lineHeight: 1.6,
                  fontFamily: "'DM Sans',sans-serif", color: L.dark,
                  background: L.cream, resize: "none", outline: "none",
                  transition: "border-color 0.2s, box-shadow 0.2s",
                }}
                onFocus={e => { e.target.style.borderColor = L.orange + "55"; e.target.style.boxShadow = `0 0 0 3px ${L.orange}12`; }}
                onBlur={e => { e.target.style.borderColor = L.orange + "15"; e.target.style.boxShadow = "none"; }}
              />

              {error && <p style={{
                fontFamily: "'DM Sans',sans-serif", fontSize: 13, color: L.coral, margin: "12px 0 0", textAlign: "center",
              }}>{error}</p>}

              <button onClick={() => ok && onGenerate(text.trim())} disabled={!ok}
                style={{
                  width: "100%", marginTop: 14, padding: "15px 20px",
                  borderRadius: 16, border: "none", fontSize: 15,
                  fontWeight: 700, fontFamily: "'DM Sans',sans-serif",
                  cursor: ok ? "pointer" : "default",
                  color: ok ? "#fff" : L.mutedLight,
                  background: ok ? L.orange : `${L.orange}0C`,
                  boxShadow: ok ? `0 6px 24px ${L.orange}38` : "none",
                  transition: "all 0.3s ease",
                }}>
                {loading ? "Analizando ¬∑ Brewing..." : "Brew My cafecitoDNA ‚Üí"}
              </button>
            </div>

            <div style={{ display: "flex", justifyContent: "center", marginTop: 20 }}>
              <span style={{ fontFamily: "'DM Sans',sans-serif", fontSize: 12, color: L.mutedLight }}>
                AI-powered ¬∑ gratis ¬∑ sin cuenta
              </span>
            </div>

            <div style={{ display: "flex", alignItems: "center", justifyContent: "center", gap: 14, marginTop: 16 }}>
              <a href={INSTAGRAM_LINK} target="_blank" rel="noopener noreferrer" style={{
                fontFamily: "'Pacifico',cursive", fontSize: 15, color: L.orange, textDecoration: "none",
              }}>lento</a>
              <span style={{ color: L.mutedLight, fontSize: 10 }}>¬∑</span>
              <a href={WHATSAPP_LINK} target="_blank" rel="noopener noreferrer" style={{
                fontFamily: "'DM Sans',sans-serif", fontSize: 12, fontWeight: 500,
                color: L.muted, textDecoration: "none", borderBottom: `1px solid ${L.muted}30`,
              }}>üí¨ Feedback</a>
            </div>
          </div>
        </div>
      );
    };

    // ‚îÄ‚îÄ‚îÄ Card ‚îÄ‚îÄ‚îÄ
    const Card = ({ profile: init, onReset }) => {
      const [p, setP] = useState(init);
      const [edit, setEdit] = useState(false);
      const [copied, setCopied] = useState(false);

      const profileText = `‚òï Mi cafecitoDNA\n\nSabores: ${(p.flavors || []).join(", ")}\nIntensidad: ${p.intensity}${p.intensityNote ? ` ‚Äî ${p.intensityNote}` : ""}\nDulzura: ${p.sweetness}${p.sweetnessNote ? ` ‚Äî ${p.sweetnessNote}` : ""}\nLeche: ${p.milk}\nTemp: ${p.temperature}${p.temperatureNote ? ` ‚Äî ${p.temperatureNote}` : ""}\n${p.dealbreakers?.length ? `No: ${p.dealbreakers.join(", ")}` : ""}\n\nPide esto ¬∑ Try these:\n${(p.drinks || []).map(d => `${d.emoji} ${d.name} ‚Äî ${d.why}`).join("\n")}\n\n‚ú¶ lento`;

      const handleShare = () => {
        navigator.clipboard.writeText(profileText).then(() => {
          setCopied(true); setTimeout(() => setCopied(false), 2200);
        });
      };

      const accents = [L.orange, L.coral, L.teal, L.green];

      return (
        <div style={{ minHeight: "100vh", display: "flex", alignItems: "center", justifyContent: "center", padding: 20, background: bg }}>
          <div style={{ width: "100%", maxWidth: 420 }}>
            <div style={{
              borderRadius: 28, overflow: "hidden",
              background: L.white90, backdropFilter: "blur(24px)",
              border: `1px solid ${L.orange}15`,
              boxShadow: `0 20px 56px ${L.orange}0E`,
              animation: "fadeUp 0.45s ease-out",
            }}>
              <div style={{ height: 4, background: `linear-gradient(90deg, ${L.orange}, ${L.ember} 50%, ${L.teal})` }} />

              <div style={{ padding: "28px 28px 20px", textAlign: "center" }}>
                <div style={{ display: "inline-block", marginBottom: 14 }}><Logo size="small" /></div>
                <h1 style={{
                  fontFamily: "'Playfair Display',serif", fontSize: 24, fontWeight: 700, color: L.dark, margin: "0 0 2px",
                }}>Mi cafecitoDNA</h1>
                <p style={{ fontFamily: "'DM Sans',sans-serif", fontSize: 13, color: L.muted, margin: 0 }}>My cafecitoDNA</p>
              </div>

              <div style={{ margin: "0 28px", height: 1, background: `linear-gradient(to right, transparent, ${L.orange}18, transparent)` }} />

              <div style={{ padding: "20px 28px" }}>
                <div style={{ marginBottom: 18 }}>
                  <Label es="Sabores" en="Flavors" />
                  <div style={{ display: "flex", flexWrap: "wrap", gap: 6 }}>
                    {(p.flavors || []).map((f, i) => (
                      <Tag key={i} variant={["orange", "teal", "green"][i % 3]} editable={edit} onRemove={() => {
                        const nf = [...p.flavors]; nf.splice(i, 1); setP({ ...p, flavors: nf });
                      }}>{f}</Tag>
                    ))}
                  </div>
                </div>

                <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10, marginBottom: 18 }}>
                  {[
                    { es: "Intensidad", en: "Intensity", key: "intensity", note: "intensityNote" },
                    { es: "Dulzura", en: "Sweetness", key: "sweetness", note: "sweetnessNote" },
                    { es: "Leche", en: "Milk", key: "milk" },
                    { es: "Temperatura", en: "Temp", key: "temperature", note: "temperatureNote" },
                  ].map(({ es, en, key, note }, i) => (
                    <div key={key} style={{
                      padding: 13, borderRadius: 14, background: accents[i] + "06",
                      borderLeft: `3px solid ${accents[i]}40`,
                    }}>
                      <Label es={es} en={en} />
                      <div style={{ fontSize: 14, fontWeight: 600, color: L.darkWarm, fontFamily: "'DM Sans',sans-serif", marginTop: -2 }}>
                        <Editable value={p[key] || ""} onChange={v => setP({ ...p, [key]: v })} editable={edit} />
                      </div>
                      {note && p[note] && <div style={{
                        fontSize: 11, color: L.muted, marginTop: 3, fontFamily: "'DM Sans',sans-serif", fontStyle: "italic",
                      }}>{p[note]}</div>}
                    </div>
                  ))}
                </div>

                {p.dealbreakers?.length > 0 && (
                  <div style={{ marginBottom: 18 }}>
                    <Label es="üö´ No me gusta" en="Dealbreakers" />
                    <div style={{ display: "flex", flexWrap: "wrap", gap: 6 }}>
                      {p.dealbreakers.map((d, i) => (
                        <Tag key={i} variant="coral" editable={edit} onRemove={() => {
                          const nd = [...p.dealbreakers]; nd.splice(i, 1); setP({ ...p, dealbreakers: nd });
                        }}>{d}</Tag>
                      ))}
                    </div>
                  </div>
                )}
              </div>

              <div style={{ margin: "0 28px", height: 1, background: `linear-gradient(to right, transparent, ${L.orange}18, transparent)` }} />

              <div style={{ padding: "20px 28px" }}>
                <Label es="‚ú® Pide esto" en="Try these" />
                <div style={{ display: "flex", flexDirection: "column", gap: 8, marginTop: 4 }}>
                  {(p.drinks || []).map((d, i) => (
                    <div key={i} style={{
                      display: "flex", alignItems: "flex-start", gap: 12,
                      padding: 13, borderRadius: 16,
                      background: "rgba(255,255,255,0.65)", border: `1px solid ${L.orange}0A`,
                      animation: `fadeUp 0.35s ease-out ${i * 0.06}s both`,
                    }}>
                      <span style={{
                        fontSize: 18, flexShrink: 0, width: 38, height: 38,
                        display: "flex", alignItems: "center", justifyContent: "center",
                        borderRadius: 11, background: `${L.orange}10`,
                      }}>{d.emoji}</span>
                      <div>
                        <div style={{ fontFamily: "'Playfair Display',serif", fontWeight: 600, fontSize: 14, color: L.dark }}>{d.name}</div>
                        <div style={{ fontFamily: "'DM Sans',sans-serif", fontSize: 13, color: L.muted, marginTop: 2, lineHeight: 1.45 }}>{d.why}</div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              <div style={{ margin: "0 28px", height: 1, background: `linear-gradient(to right, transparent, ${L.orange}18, transparent)` }} />

              <div style={{ padding: "4px 28px 28px", display: "flex", gap: 8 }}>
                <button onClick={() => setEdit(!edit)} style={{
                  flex: 1, padding: 14, borderRadius: 14, fontSize: 14,
                  fontWeight: 600, fontFamily: "'DM Sans',sans-serif", cursor: "pointer",
                  border: edit ? `2px solid ${L.orange}45` : `2px solid ${L.orange}15`,
                  background: edit ? `${L.orange}10` : "transparent",
                  color: edit ? L.orangeDeep : L.muted,
                }}>
                  {edit ? "‚úì Listo" : "‚úèÔ∏è Editar"}
                </button>
                <button onClick={handleShare} style={{
                  flex: 1, padding: 14, borderRadius: 14, fontSize: 14,
                  fontWeight: 600, fontFamily: "'DM Sans',sans-serif", cursor: "pointer",
                  border: "none", color: "#fff",
                  background: copied ? L.green : L.orange,
                  boxShadow: `0 5px 20px ${copied ? L.green : L.orange}30`,
                }}>
                  {copied ? "‚úì ¬°Copiado!" : "üì§ Compartir"}
                </button>
                {onReset && (
                  <button onClick={onReset} style={{
                    padding: "14px 16px", borderRadius: 14, fontSize: 14,
                    fontFamily: "'DM Sans',sans-serif", cursor: "pointer",
                    border: `2px solid ${L.orange}15`, background: "transparent", color: L.muted,
                  }}>üîÑ</button>
                )}
              </div>
            </div>

            <div style={{
              display: "flex", alignItems: "center", justifyContent: "center", gap: 14, marginTop: 20,
            }}>
              <a href={INSTAGRAM_LINK} target="_blank" rel="noopener noreferrer" style={{
                fontFamily: "'Pacifico',cursive", fontSize: 15, color: L.orange, textDecoration: "none",
              }}>lento</a>
              <span style={{ color: L.mutedLight, fontSize: 10 }}>¬∑</span>
              <a href={WHATSAPP_LINK} target="_blank" rel="noopener noreferrer" style={{
                fontFamily: "'DM Sans',sans-serif", fontSize: 12, fontWeight: 500,
                color: L.muted, textDecoration: "none", borderBottom: `1px solid ${L.muted}30`,
              }}>üí¨ Feedback</a>
            </div>
          </div>
        </div>
      );
    };

    // ‚îÄ‚îÄ‚îÄ App ‚îÄ‚îÄ‚îÄ
    function App() {
      const [screen, setScreen] = useState("landing");
      const [profile, setProfile] = useState(null);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState(null);

      const generate = async (desc) => {
        setLoading(true); setError(null);
        try {
          const res = await fetch("/api/generate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ description: desc }),
          });
          const data = await res.json();
          if (!res.ok) throw new Error(data.error || "Server error");
          setProfile(data);
          setScreen("card");
        } catch (e) {
          console.error(e);
          setError("Algo sali√≥ mal ¬∑ Something went wrong!");
        } finally { setLoading(false); }
      };

      if (screen === "card" && profile) return <Card profile={profile} onReset={() => { setProfile(null); setScreen("landing"); }} />;
      return <Landing onGenerate={generate} loading={loading} error={error} />;
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
